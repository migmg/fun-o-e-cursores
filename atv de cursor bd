1) CREATE FUNCTION total_livros_por_genero(nome_genero_param VARCHAR(255))
RETURNS INT
BEGIN
    DECLARE total INT;
    DECLARE done INT DEFAULT 0;
    DECLARE livro_id INT;
    DECLARE genero_nome VARCHAR(255);

    DECLARE cur CURSOR FOR
        SELECT L.id, G.nome_genero
        FROM Livro L
        JOIN Genero G ON L.id_genero = G.id;

    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;

    SET total = 0;

    OPEN cur;

    read_loop: LOOP
        FETCH cur INTO livro_id, genero_nome;
        IF done THEN
            LEAVE read_loop;
        END IF;

        IF genero_nome = nome_genero_param THEN
            SET total = total + 1;
        END IF;
    END LOOP;

    CLOSE cur;

    RETURN total;
END;

//

DELIMITER ;
